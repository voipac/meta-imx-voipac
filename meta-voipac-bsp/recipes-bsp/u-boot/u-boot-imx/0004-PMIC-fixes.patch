From 1202bb6e987405763d034ceed8a2b8b5dc58354f Mon Sep 17 00:00:00 2001
From: Marek Belisko <marek.belisko@open-nandra.com>
Date: Mon, 8 Jul 2024 13:47:26 +0200
Subject: [PATCH] PMIC fixes

Signed-off-by: Marek Belisko <marek.belisko@open-nandra.com>
---
 arch/arm/dts/imx93-11x11-evk-u-boot.dtsi |  8 +++---
 arch/arm/dts/imx93-11x11-evk.dts         | 36 +++++++++++++-----------
 2 files changed, 23 insertions(+), 21 deletions(-)

diff --git a/arch/arm/dts/imx93-11x11-evk-u-boot.dtsi b/arch/arm/dts/imx93-11x11-evk-u-boot.dtsi
index 688f706d7b..58c2f3cd08 100644
--- a/arch/arm/dts/imx93-11x11-evk-u-boot.dtsi
+++ b/arch/arm/dts/imx93-11x11-evk-u-boot.dtsi
@@ -125,11 +125,11 @@
 	u-boot,dm-spl;
 };
 
-&{/soc@0/bus@44000000/i2c@44350000/pmic@25} {
+&{/soc@0/bus@44000000/i2c@44340000/pmic@25} {
 	u-boot,dm-spl;
 };
 
-&{/soc@0/bus@44000000/i2c@44350000/pmic@25/regulators} {
+&{/soc@0/bus@44000000/i2c@44340000/pmic@25/regulators} {
 	u-boot,dm-spl;
 };
 
@@ -146,13 +146,13 @@
 };
 
 &fec {
-	phy-reset-gpios = <&gpioexp 10 GPIO_ACTIVE_LOW>;
+	phy-reset-gpios = <&gpio_ext_som 9 GPIO_ACTIVE_LOW>;
 	phy-reset-duration = <15>;
 	phy-reset-post-delay = <100>;
 };
 
 &ethphy1 {
-	reset-gpios = <&gpioexp 12 GPIO_ACTIVE_LOW>;
+	reset-gpios = <&gpio_ext_som 11 GPIO_ACTIVE_LOW>;
 	reset-assert-us = <15000>;
 	reset-deassert-us = <100000>;
 };
diff --git a/arch/arm/dts/imx93-11x11-evk.dts b/arch/arm/dts/imx93-11x11-evk.dts
index 756a611473..8d8880db75 100644
--- a/arch/arm/dts/imx93-11x11-evk.dts
+++ b/arch/arm/dts/imx93-11x11-evk.dts
@@ -110,32 +110,24 @@
 	pinctrl-1 = <&pinctrl_lpi2c1>;
 	status = "okay";
 
-        gpioexp: gpioexp@27 {
+	gpio_ext_som: gpio_ext_som@27 {
                 compatible = "nxp,pca9535";
-                reg = <0x27>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_pca9535>;
+                pinctrl-names = "default";
+                pinctrl-0 = <&pinctrl_pca9535>;
                 gpio-controller;
                 #gpio-cells = <2>;
-		interrupt-parent = <&gpio2>;
+                reg = <0x27>;
+                interrupt-parent = <&gpio2>;
                 interrupts = <18 IRQ_TYPE_LEVEL_LOW>;
+                interrupt-controller;
+                #interrupt-cells = <2>;
+        };
 
-	};
-};
-
-&lpi2c2 {
-	#address-cells = <1>;
-	#size-cells = <0>;
-	clock-frequency = <400000>;
-	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&pinctrl_lpi2c2>;
-	pinctrl-1 = <&pinctrl_lpi2c2>;
-	status = "okay";
 
 	pmic@25 {
 		compatible = "nxp,pca9451a";
 		reg = <0x25>;
-		interrupt-parent = <&gpioexp>;
+		interrupt-parent = <&gpio_ext_som>;
 		interrupts = <4 IRQ_TYPE_LEVEL_LOW>;
 
 		regulators {
@@ -209,6 +201,16 @@
 
 };
 
+&lpi2c2 {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	clock-frequency = <400000>;
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_lpi2c2>;
+	pinctrl-1 = <&pinctrl_lpi2c2>;
+	status = "okay";
+};
+
 &lpi2c3 {
 	#address-cells = <1>;
 	#size-cells = <0>;
-- 
2.34.1

